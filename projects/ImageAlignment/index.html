<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Image Alignment | Dayoon Suh </title> <meta name="author" content="Dayoon Suh"> <meta name="description" content="Image channel alignment"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/star16.png?8313f39206cc4c988d004cc656add13a"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://dayoonsuh.github.io/projects/ImageAlignment/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Dayoon Suh </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Image Alignment</h1> <p class="post-description">Image channel alignment</p> </header> <article> <p>Given a grayscale image consisting of three channel images (R, G, B), the goal is to extract each channel image and align these images to form a single, properly colorized image.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ImageAlignment/teaser.png" sizes="95vw"></source> <img src="/assets/img/ImageAlignment/teaser.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h1 id="mathematical-formulation-of-the-alignment-procedure">Mathematical Formulation of the Alignment Procedure</h1> <p>Given a gray scale image \(I\) consisting of three channel images \(\{I_R, I_G, I_B\} \in \mathbb{R}^{H \times W}\), corresponding to the Red, Green, and Blue channels of a color image, where \(H\) is height, \(W\) is width, the goal is to extract each channel image and align these images to form a single, properly colorized image \(I_{RGB} \in \mathbb{R}^{3 \times H \times W}\), where 3 is the number of channels of an image. The challenge is to find the optimal displacement vectors \((dx_R, dy_R)\), \((dx_G, dy_G)\), and \((dx_B, dy_B)\) that align the channels such that visual artifacts are minimized. Details are illustrated below.</p> <hr> <h2 id="procedures">Procedures</h2> <p>The following steps outline the procedure to align the color channels:</p> <h3 id="1-preprocessing-the-images">1. Preprocessing the Images</h3> <ul> <li>Remove the white borders to isolate the main content of each channel.</li> <li>Divide the input image into three parts, corresponding to the three color channels.</li> </ul> <h3 id="2-pair-alignment">2. Pair Alignment</h3> <ul> <li>Choose one of the channels (e.g., Green channel) as the reference.</li> <li>Crop the outer part and use the middle part of each channel to compute the pair alignment for the other two channels (e.g., Red and Blue) relative to the reference channel using one of the defined metrics (MSE, NCC, SSIM), within the defined search window.</li> </ul> <p><em>From now on, the explanations assume the reference color as Green, and the other two channels as Red and Blue.</em></p> <h3 id="3-optimization">3. Optimization</h3> <ul> <li>Using the Brute Force algorithm, exhaustively search for the displacement vectors \((dx_R, dy_R)\) and \((dx_B, dy_B)\) within the search window \([-15, 15]\) that minimize the align metric.</li> <li>Evaluate the alignment cost function for each possible displacement within the window.</li> <li>Select the displacement vector that yields the minimum cost as the optimal alignment.</li> </ul> <p><em>The displacement vector for the reference color is \((dx_G, dy_G) = (0, 0)\).</em></p> <h3 id="4-final-alignment">4. Final Alignment</h3> <ul> <li>Apply the displacements to the uncropped respective channels and merge the aligned channels together to produce the final RGB image \(I_{RGB}\).</li> </ul> <h2 id="alignment-costs">Alignment Costs</h2> <p>We define \(D(I_{\text{ref}}, I_{shift})\) as the alignment cost function, where \(I_{\text{ref}}\) is the reference channel image and \(I_{shift}\) is the shifted channel image. (e.g., \(I_{\text{ref}} = I_G, I_{shift} = I_C(x + dx_C, y + dy_C)\) where \(C = \{R, B\}\)). There are three alignment costs to consider:</p> <ul> <li><strong>Mean Squared Error (MSE)</strong></li> <li> <strong>Normalized Cross-Correlation (NCC)</strong><br> <em>(Negative NCC is implemented)</em> </li> <li><strong>Structural Similarity Index (SSIM)</strong></li> </ul> <p><em>Lower value represents better alignment within each metric.</em></p> <hr> <h2 id="optimization-problem">Optimization Problem</h2> <p>The goal is to find the displacement vectors \(d_C = (dx_C, dy_C)\) that minimize the cost function:</p> \[\arg \min_{d_C} D(I_{\text{ref}}, I_{shifted})\] <hr> <h2 id="constraints">Constraints</h2> <h3 id="search-window">Search Window:</h3> <p>To limit the computational cost, the search for \(dx\) and \(dy\) is restricted to a finite window of pixel size 15, in both \(x\) and \(y\) directions:</p> \[-15 \leq dx_C, dy_C \leq 15, \text{ for } C \in \{R, B\}.\] <h1 id="description-of-implementation">Description of Implementation</h1> <h3 id="preprocessing-the-images">Preprocessing the Images</h3> <p>To remove the white boundary from an image, I first calculated the row and column means of the pixel values. Since white areas have high values (close to 1) and black areas have low values (close to 0), I enhanced the contrast by cubing the mean values. This exaggeration made it easier to distinguish the boundary. I then cropped the image by selecting the indices where the mean values dropped below 0.1, effectively removing the white boundary. After identifying the boundaries, I divided the image into three equal parts by splitting its height into three sections.</p> <hr> <h3 id="cropping-the-outer-parts">Cropping the Outer Parts</h3> <p>To ensure an accurate comparison between the image channels, I first cropped the outer part of each channel to focus on the main area, which is the central part of the images. This strategy not only improved the alignment but also significantly reduced the execution time, as it reduced the amount of pixels to be padded.</p> <p>I experimented with different sizes for the cropped section: 100 × 100, 200 × 200, and the full (uncropped) image. Initially, I thought optimizing the uncropped image would lead to poor alignment because the cost calculation would include the black frame pixels and would increase the gap when the black boundary and non-black boundary meet. However, the alignment turned out better than I expected. That said, the execution time for the uncropped image was significantly longer. I believe the difference in execution time is due to the varying number of pixels being optimized.</p> <h3 id="effect-of-metrics">Effect of Metrics</h3> <h4 id="alignment-quality">Alignment Quality</h4> <p>When the reference color was green and the order of channel alignment is RGB, it was not distinguishable which metric performs better in optimization because every metric worked out well. However, the difference showed up when the reference color changed. Overall, MSE proved to be the least effective alignment metric, likely due to its sensitivity to outliers. In contrast, SSIM delivered the best performance, as it focuses on structural similarity rather than pixel-wise differences, making it more robust for alignment tasks.</p> <h4 id="speed-of-computation">Speed of Computation</h4> <p>It turned out that MSE took the least time, followed by NCC, with only a small difference in execution times between the two. However, SSIM took significantly longer to optimize in comparison, indicating that it is computationally more expensive. This is likely due to the more complex nature of SSIM, which evaluates structural information in the images, compared to MSE and NCC, which focus on pixel-based differences and normalized correlations respectively.</p> <h1 id="colorized-outputs">Colorized Outputs</h1> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ImageAlignment/results/1_ssim_aligned.png" sizes="95vw"></source> <img src="/assets/img/ImageAlignment/results/1_ssim_aligned.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ImageAlignment/results/2_ssim_aligned.png" sizes="95vw"></source> <img src="/assets/img/ImageAlignment/results/2_ssim_aligned.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ImageAlignment/results/3_ssim_aligned.png" sizes="95vw"></source> <img src="/assets/img/ImageAlignment/results/3_ssim_aligned.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ImageAlignment/results/4_ssim_aligned.png" sizes="95vw"></source> <img src="/assets/img/ImageAlignment/results/4_ssim_aligned.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ImageAlignment/results/5_ssim_aligned.png" sizes="95vw"></source> <img src="/assets/img/ImageAlignment/results/5_ssim_aligned.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/ImageAlignment/results/6_ssim_aligned.png" sizes="95vw"></source> <img src="/assets/img/ImageAlignment/results/6_ssim_aligned.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Dayoon Suh. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>